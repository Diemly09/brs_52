<% provide :title, t("home") %>
<div class="home-page">
  <% if user_signed_in? %>
    <div class="col-sm-3">
      <div class="td-right-nav-title">
        <h4>
          <%= image_tag "book.svg" %>
          Hôm nay bạn đọc gì?
        </h4>
      </div>
      <hr>
      <div class="td-right-nav-content">
        <h3>
          Bình chọn nhiều nhất
        </h3>
        <div class="col-sm-5">
          <div class="row td-img-book-popular">
            <% if @book_challenge.first.image %>
              <%= link_to book_path(@book_challenge.first) do %>
                <%= image_tag @book_challenge.first.image, class: "img-responsive" %>
              <% end %>
            <% else %>
              <%= link_to book_path(@book_challenge.first) do %>
                <%= image_tag "book.jpg", class: "img-responsive" %>
              <% end %>
            <% end %>
          </div>
        </div>
        <div class="col-sm-7">
          <div class="book-rating">
            <%= render "ratings/stars", rating: @book_challenge.first.rating %>
          </div>
          <div class="book-status-<%= @user_book.book_id %>">
            <%= render "user_books/change_statuses", user_book: @user_book %>
          </div>
        </div>
        <div class="clearfix"></div>
      </div>
      <hr>
      <div class="td-right-nav-footer">
        <h3>
          Thể loại yêu thích
          <%= link_to "Tất cả sách", books_path %>
        </h3>
        <div class="navcat">
        <ul class="home-list-category-2">
          <% @categories.each do |category| %>
             <li class="text-center">
              <%= link_to category_path(category) do %>

                <%= category.name %>

              <% end %>
            </li>
          <% end %>
        </ul>
        </div>
        <div class="td-view-all-book"></div>
      </div>
    </div>
    <div class="col-sm-6 padding-50">
      <% @reviews.each do |review| %>
        <div class="review review-<%= review.id %> clearfix">
          <div class="col-sm-12 td-user-review-title">
            <div class="inline-block td-home-user-review">
              <%= user_avatar review.user %>
            </div>
            <div class="inline-block user-info-review">
              <div class="user inline-block">
                <%= link_to review.user.name, user_path(review.user) %>
                <%= t "books.rated_it" %>
                <%= render "ratings/stars",
                  rating: review.rating ? review.rating.rating : 0 %>
              </div>
              <div class="time-create-review inline-block float-right">
                <%= time_ago_in_words review.created_at %>
              </div>
            </div>
          </div>
          <div class="col-sm-12 td-user-review-content">
            <div class="col-md-4">
              <% if review.book.image %>
                <%= image_tag review.book.image,
                  class: "img-responsive review-book-image" %>
              <% else %>
                <%= image_tag "book.jpg",
                  class: "img-responsive review-book-image" %>
              <% end %>
            </div>
            <div class="col-md-8 td-user-review-content-right">
              <h3>
                <%= link_to book_path(review.book) do %>
                  <%= review.book.title %>
                <% end %>
              </h3>

              <i>bởi <%= review.book.author %></i>

              <div class="book-status-<%= review.book.id %> book-review-change">
                <%= render "user_books/change_statuses",
                  user_book: mark_book(review.book) %>
              </div>

              <% if strip_tags(review.content).length > 300 %>
                <div class="content-review-less">
                  <%= truncate strip_tags(review.content), length: 200 %>
                  <%= link_to t("books.more"), "#", class: "show-more",
                    remote: true %>
                </div>
                <div class="content-review-full hidden">
                  <%= review.content.html_safe %>
                  <%= link_to t("books.less"), "#", class: "show-less",
                    remote: true %>
                </div>
              <% else %>
                <div class="content-review-full">
                  <%= review.content.html_safe %>
                </div>
              <% end %>
            </div>
            <div class="clearfix"></div>
            <hr>
            <div class="col-md-12 like">
              <span class="review-like-<%= review.id %>">
                <% if current_user.like review %>
                  <%= render "likes/dislikes", like: current_user.like(review),
                    target: review %>
                <% else %>
                  <%= render "likes/likes", target: review %>
                <% end %>
              </span>
              <%= link_to t("reviews.actions.see"), book_path(review.book) %>
            </div>
          </div>
        </div>
      <% end %>
      <div class="td-wrap-pagination" style="text-align: center; width: 100%;
        padding: 30px 0;">
        <%= paginate @reviews %>
      </div>
    </div>
    <div class="col-sm-3 td-right-nav">
      <p style="font-weight: 600;">Có thể bạn thích đọc?</p>
      <div class="col-sm-12 height-100">
        <div class="col-sm-5">
          <div class="row">
            <% if @book_challenge.second && @book_challenge.second.image %>
              <%= link_to book_path(@book_challenge.second) do %>
                <%= image_tag @book_challenge.second.image,
                  class: "img-responsive" %>
              <% end %>
            <% else %>
              <%= link_to book_path(@book_challenge.second) do %>
                <%= image_tag "book.jpg", class: "img-responsive" %>
              <% end %>
            <% end %>
          </div>
        </div>
        <div class="col-sm-5">
          <div class="row">
            <% if @book_challenge.third && @book_challenge.third.image %>
              <%= link_to book_path(@book_challenge.third) do %>
                <%= image_tag @book_challenge.third.image,
                  class: "img-responsive" %>
              <% end %>
            <% else %>
              <%= link_to book_path(@book_challenge.third) do %>
                <%= image_tag "book.jpg", class: "img-responsive" %>
              <% end %>
            <% end %>
          </div>
        </div>
      </div>
      <div class="col-sm-12 height-100">
        <div class="col-sm-5">
          <div class="row">
            <% if @book_challenge.fourth && @book_challenge.fourth.image %>
              <%= link_to book_path(@book_challenge.fourth) do %>
                <%= image_tag @book_challenge.fourth.image,
                  class: "img-responsive" %>
              <% end %>
            <% else %>
              <%= link_to book_path(@book_challenge.fourth) do %>
                <%= image_tag "book.jpg", class: "img-responsive" %>
              <% end %>
            <% end %>
          </div>
        </div>
        <div class="col-sm-5">
          <div class="row">
            <% if @book_challenge.fifth && @book_challenge.fifth.image %>
              <%= link_to book_path(@book_challenge.fifth) do %>
                <%= image_tag @book_challenge.fifth.image,
                  class: "img-responsive" %>
              <% end %>
            <% else %>
              <%= link_to book_path(@book_challenge.fifth) do %>
                <%= image_tag "book.jpg", class: "img-responsive" %>
              <% end %>
            <% end %>
          </div>
        </div>
      </div>
      <div class="clearfix"></div>
      <hr>
      <div class="col-sm-12 td-home-footer">
        <div class="col-sm-6">
          <ul class="row">
            <li><%= link_to "Giới thiệu", "#" %></li>
            <li><%= link_to "Các tác giả", "#" %></li>
          </ul>
        </div>
        <div class="col-sm-6">
          <ul>
            <li><%= link_to "Chính sách", "#" %></li>
            <li><%= link_to "Điều khoản", "#" %></li>
          </ul>
        </div>
        <div style="display: inline-block"><%= link_to "© 2017 BookReview", "#" %></div>
      </div>
    </div>
  <% end %>
</div>
